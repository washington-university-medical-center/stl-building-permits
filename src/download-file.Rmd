---
title: "Building Permit Data Prep"
author: "Jes Stevens"
date: "12/20/2019"
output: html_document
params: 
  date: "12-30-19"
---

# Load Libraries 

```{r}
library(dplyr)
library(RODBC)
library(rgdal)
library(maptools)
library(tidyverse)
library(sp)
library(sf)
library(ggplot2)
library(here)
library(utils)

```

# Download Access Database

```{r}
# Creates Temporary Location
temp <- tempfile()

# Downloads file to Temporary Location 
download.file("https://www.stlouis-mo.gov/data/upload/data-files/prmbdo.zip",temp)

# Tests to see if the Folder Exsists
test <- dir.exists(here("data", "historical-dbs", params$date))

# Creates folder if test returns a FALSE value
if(test == FALSE) {
   dir.create(here("data", "historical-dbs", params$date))
}

# Tests to see if the folder is empty
files <- list.files(path = here("data", "historical-dbs", params$date))
is_empty(files) -> test

# Unzips Downloaded file from temporary location to historical files archive
if(test == TRUE) {
   unzip(temp, exdir = here("data", "historical-dbs", params$date))
}

# Unzips Downloaded files to the working directory and overwrites the file
unzip(temp, exdir = here("data", "working-db"), overwrite = TRUE)
```

